<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta charset="utf-8">
  <meta name="generator" content="Hugo 0.58.2" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Adnaan Badr">
  <meta property="og:url" content="https://adnaan.badr.in/blog/2019/10/22/nifty-go-pkg-ory/dockertest/">

  <title>Nifty Go Pkg: ory/dockertest - Time Traveling Gopher</title>
  <meta property="og:title" content="Nifty Go Pkg: ory/dockertest - Time Traveling Gopher">
  <meta property="og:type" content="article">
  <meta name="description" content="">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Arvo:400,700">
  <link rel="stylesheet" href="/css/highlight.css">
  <link rel="stylesheet" href="/css/journal.css">
  <link href="/index.xml" rel="alternate" type="application/rss+xml" title="Time Traveling Gopher">

</head>

<body>
  <div class="container">

    <nav class="site-nav">
      <a href="https://adnaan.badr.in">Index</a>
    </nav>


  <article class="post">
    <header class="post-header">
      <h1 class="post-title">Nifty Go Pkg: ory/dockertest</h1>
      <time class="post-date" datetime="2019-10-22 08:31:33 CEST">22 Oct 2019</time>
    </header>

    

<p>A package I often use and find extremely useful for intergation testing is <a href="https://github.com/ory/dockertest/">dockertest</a></p>

<h3 id="use-case">Use Case</h3>

<p>You want to setup and tear down a real database for each integration test run.</p>

<p>An example from the <code>dockertest</code> repository</p>

<pre><code class="language-go">var db *redis.Client
var err error
pool, err = dockertest.NewPool(&quot;&quot;)
if err != nil {
    log.Fatalf(&quot;Could not connect to docker: %s&quot;, err)
}

resource, err := pool.Run(&quot;redis&quot;, &quot;3.2&quot;, nil)
if err != nil {
    log.Fatalf(&quot;Could not start resource: %s&quot;, err)
}

if err = pool.Retry(func() error {
    db = redis.NewClient(&amp;redis.Options{
        Addr: fmt.Sprintf(&quot;localhost:%s&quot;, resource.GetPort(&quot;6379/tcp&quot;)),
    })

    return db.Ping().Err()
}); err != nil {
    log.Fatalf(&quot;Could not connect to docker: %s&quot;, err)
}

// When you're done, kill and remove the container
err = pool.Purge(resource)
</code></pre>


  </article>

<footer class="site-footer">
  <span itemscope itemtype="http://schema.org/Person">
    <link itemprop="url" href="https://adnaan.badr.in">
    <span itemprop="name">Adnaan Badr</span>

    <br>

    <a itemprop="sameAs" href="https://github.com/adnaan" title="GitHub">Github</a>

    <a itemprop="sameAs" href="https://twitter.com/adnaanx" title="Twitter">Twitter</a>


    <a itemprop="sameAs" href="https://www.linkedin.com/in/adnaanx"
      title="LinkedIn">LinkedIn</a>


    
  </span>

  
</footer>
</div>

<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>

</html>
